# データモデル（構造体・状態管理）設計書

作成日: 2026年1月31日
対象: Rust + Tauri によるLinux向けワイヤーフレーム作成アプリ
目的: アプリ内で扱うデータの「形」と保持方式を定義

---

## 1. Struct（構造体）定義（Rust側）

> `serde` によるシリアライズ/デシリアライズを前提

### 1.1 `AppError`
- 用途: APIのエラー表現
- フィールド:
  - `code: String`
  - `message: String`
  - `details: Option<serde_json::Value>`

### 1.2 `CanvasSpec`
- 用途: キャンバス仕様
- フィールド:
  - `width: i32`
  - `height: i32`
  - `unit: String`（例: "px"）
  - `background: String`（HEXカラー）

### 1.3 `Frame`
- 用途: 位置とサイズ
- フィールド:
  - `x: i32`
  - `y: i32`
  - `w: i32`
  - `h: i32`

### 1.4 `TextStyle`
- 用途: テキスト属性
- フィールド:
  - `value: String`
  - `font: String`
  - `size: i32`
  - `color: String`

### 1.5 `NodeStyle`
- 用途: 図形スタイル
- フィールド:
  - `fill: String`
  - `stroke: String`
  - `opacity: f32`

### 1.6 `Node`
- 用途: 図形/テキスト要素
- フィールド:
  - `id: String`
  - `node_type: String`（"rect" | "ellipse" | "line" | "text" | "image"）
  - `name: String`
  - `frame: Frame`
  - `rotation: f32`
  - `style: NodeStyle`
  - `text: Option<TextStyle>`
  - `children: Vec<Node>`

### 1.7 `Page`
- 用途: 画面単位のノード集合
- フィールド:
  - `id: String`
  - `name: String`
  - `nodes: Vec<Node>`

### 1.8 `AssetInfo`
- 用途: 取り込みアセット
- フィールド:
  - `id: String`
  - `name: String`
  - `asset_type: String`（"png" | "jpg" | "svg"）
  - `path: String`

### 1.9 `ExportSpec`
- 用途: エクスポート指定
- フィールド:
  - `format: String`（"png" | "svg" | "pdf"）
  - `scale: i32`
  - `include_background: bool`

### 1.10 `ProjectInfo`
- 用途: プロジェクト一覧/メタ情報
- フィールド:
  - `id: String`
  - `name: String`
  - `path: String`
  - `updated_at: String`（ISO-8601）
  - `pages: i32`

### 1.11 `ProjectData`
- 用途: プロジェクト本体
- フィールド:
  - `id: String`
  - `name: String`
  - `canvas: CanvasSpec`
  - `pages: Vec<Page>`
  - `assets: Vec<AssetInfo>`
  - `settings: AppSettings`

### 1.12 `AppSettings`
- 用途: アプリ設定
- フィールド:
  - `theme: String`（"light" | "dark"）
  - `grid: GridSettings`
  - `autosave: AutosaveSettings`
  - `recent_limit: i32`

### 1.13 `GridSettings`
- フィールド:
  - `enabled: bool`
  - `size: i32`

### 1.14 `AutosaveSettings`
- フィールド:
  - `enabled: bool`
  - `interval_sec: i32`

### 1.15 `RecentProject`
- 用途: 最近使ったプロジェクト
- フィールド:
  - `name: String`
  - `path: String`
  - `updated_at: String`

### 1.16 `AppInfo`
- 用途: アプリ情報
- フィールド:
  - `name: String`
  - `version: String`
  - `platform: String`

---

## 2. State（状態）管理（Tauri `manage`）

### 2.1 `AppState`
- 用途: アプリ起動中に共有する状態
- 保持対象:
  - `settings: AppSettings`（設定値）
  - `recent_projects: Vec<RecentProject>`（最近使った一覧）
  - `current_project: Option<ProjectData>`（開いているプロジェクト）
  - `app_info: AppInfo`（バージョン/プラットフォーム）

### 2.2 永続化が必要な状態
- `settings`
- `recent_projects`

### 2.3 セッション内のみの状態
- `current_project`

---

## 3. DB/ファイル保存形式

### 3.1 プロジェクト保存形式
- 形式: **JSONファイル**（拡張子 `.wire`）
- 理由: 可読性と移植性を重視

#### 例（ProjectData）
```json
{
  "id": "proj_123",
  "name": "My Wireframe",
  "canvas": {"width": 1440, "height": 900, "unit": "px", "background": "#FFFFFF"},
  "pages": [
    {"id": "page_1", "name": "Home", "nodes": []}
  ],
  "assets": [],
  "settings": {"theme": "dark", "grid": {"enabled": true, "size": 8}, "autosave": {"enabled": true, "interval_sec": 60}, "recent_limit": 10}
}
```

### 3.2 設定保存形式
- 形式: **JSONファイル**（例: `settings.json`）
- フィールド:
  - `theme`
  - `grid`
  - `autosave`
  - `recent_limit`

### 3.3 最近使ったプロジェクト
- 形式: **JSONファイル**（例: `recent.json`）
- フィールド:
  - `name`
  - `path`
  - `updated_at`

---

## 4. 補足
- DB（SQLite）は将来的な拡張候補とし、現時点では JSON で統一
- ファイルI/Oは `services/file_io` で集中管理
