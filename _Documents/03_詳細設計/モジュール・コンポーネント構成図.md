# モジュール・コンポーネント構成図

作成日: 2026年1月31日
対象: Rust + Tauri によるLinux向けワイヤーフレーム作成アプリ
目的: フロントエンド/バックエンドの分割と責務境界を明確化

---

## 1. 全体構成（境界の明確化）

```mermaid
flowchart LR
    subgraph FE[Frontend JS/TS + UI]
        direction TB
        UI[UIコンポーネント]
        State[状態管理]
        Canvas[キャンバス描画/編集]
        Shortcut[ショートカット/入力]
        UI -->|invoke| Bridge
    end

    subgraph Bridge[Tauri Bridge]
        direction TB
        Cmd[Command API]
    end

    subgraph BE[Backend Rust]
        direction TB
        FileIO[ファイル操作]
        Exporter[エクスポート]
        Settings[設定管理]
        System[OS統合/通知/ダイアログ]
    end

    UI --> State
    Canvas --> State
    Shortcut --> State

    Bridge --> BE
```

### 役割の境界（要点）
- **JS/TS側**: UI/UX、キャンバス操作、状態管理、軽量なバリデーション
- **Rust側**: ファイルI/O、エクスポート、OS連携、設定の永続化

---

## 2. Frontend コンポーネント分割

```mermaid
flowchart TB
    App[App Root]
    App --> Layout[MainLayout]

    Layout --> Header[Header]
    Layout --> SidebarLeft[LeftSidebar]
    Layout --> CanvasArea[CanvasArea]
    Layout --> SidebarRight[RightSidebar]
    Layout --> Footer[StatusBar]

    Header --> FileMenu[FileMenu]
    Header --> EditMenu[EditMenu]
    Header --> ViewMenu[ViewMenu]

    SidebarLeft --> ToolPanel[ToolPanel]
    SidebarLeft --> AssetPanel[AssetPanel]

    CanvasArea --> Canvas[Canvas]
    CanvasArea --> Ruler[Ruler]
    CanvasArea --> Minimap[Minimap]

    SidebarRight --> LayerPanel[LayerPanel]
    SidebarRight --> PropertyPanel[PropertyPanel]

    Footer --> ZoomControl[ZoomControl]
    Footer --> CoordDisplay[CoordDisplay]
```

---

## 3. Backend モジュール分割（Rust）

```mermaid
flowchart TB
    Core[core]
    Core --> Project[project]
    Core --> Document[document]
    Core --> Model[model]

    Services[services]
    Services --> FileIO[file_io]
    Services --> Export[export]
    Services --> Settings[settings]
    Services --> System[system]

    Api[api]
    Api --> Commands[commands]

    Commands --> Project
    Commands --> FileIO
    Commands --> Export
    Commands --> Settings
    Commands --> System
```

### モジュール責務（概要）
- `core/project`: プロジェクト管理（作成/読み込み/保存）
- `core/document`: ページ/レイヤー/ノード構造
- `core/model`: 共有データ構造（DTO/型定義）
- `services/file_io`: ファイル入出力、最近使ったファイル
- `services/export`: PNG/SVG/PDF 生成
- `services/settings`: 設定の永続化
- `services/system`: OS通知、ダイアログ
- `api/commands`: Tauriコマンドの公開窓口

---

## 4. JS/TS と Rust の責務境界

| 領域 | JS/TS（Frontend） | Rust（Backend） |
|---|---|---|
| UI描画 | 画面/コンポーネント | なし |
| キャンバス操作 | 選択/移動/変形/スナップ | なし |
| 状態管理 | 画面状態/一時データ | なし |
| 永続化 | なし | ファイル保存/読み込み |
| エクスポート | UI操作のみ | 画像/PDF生成 |
| OS連携 | なし | ダイアログ/通知 |
| 設定 | UI反映 | 保存/読み込み |

---

## 5. 境界越えの通信（例）

- JS/TS → Rust
  - `save_project(project)`
  - `export_canvas(project_id, page_id, export)`
  - `select_file_dialog(filters)`
- Rust → JS/TS
  - エラー通知（`AppError`）
  - 保存完了（`SaveResult`）
